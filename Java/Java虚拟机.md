* [一、Java内存模型](#一java内存模型)


# 一、Java内存模型
Java内存模型（JMM)：

为了缩小CPU运算速度和主存读写速度的差异，每个工作线程都会有自己的工作内存。所有变量储存在主内存中，每条线程还有自己的工作内存，里面保存了该线程使用到的变量的主内存副本拷贝，线程对变量的所有操作都是在工作内存中完成的，完成之后再将新的变量的值写回主内存，并且Java内存模型还决定了一个线程写入主内存的共享变量什么时候对其他线程是可见的。

另外JMM也是用来屏蔽各种硬件和操作系统的内存访问差异，以实现让java程序在各个平台下都能达到一致的内存访问效果。是Java多线程共享内存的抽象模型。多个线程之间通过共享内存实现线程通信。

内存模型如图（图片来源：https://www.jianshu.com/p/15106e9c4bf3）：
<div align="center"> <img src="https://upload-images.jianshu.io/upload_images/4899162-66736384361f6b8b.png?imageMogr2/auto-orient/strip|imageView2/2/format/webp"/></div><br>

### java内存模型关于主内存和工作内存的交互协议，定义了8种操作来完成：
* 1.lock：作用于主内存的变量，他把一个变量标识为一条线程独占的状态
* 2.unlock：作用于主内存的变量，他把一个处于锁定状态的变量释放出来，释放后的变量才可以被其他线程锁定
* 3.read：作用于主内存的变量，他把一个变量的值从主内存传输到线程的工作内存中，以便随后的load动作使用
* 4.load：作用于工作内存的变量，他把read操作从主内存中得到的变量值放入工作内存的变量副本中
* 5.use：作用于工作内存的变量，他把工作内存中一个变量的值传递给执行引擎，每当虚拟机遇到一个需要使用到变量的值的字节码指令时将会执行这个操作
* 6.assign（赋值）：作用于工作内存的变量，他把一个从执行引擎接受到的值赋给工作内存的变量，每当虚拟机遇到一个给变量赋值的字节码指令时执行这个操作。
* 7.store：作用于工作内存的变量，他把工作内存中一个变量的值传送到主内存中，以便随后的write操作使用
* 8.write：作用于主内存的变量，他把store操作从工作内存中得到的变量的值放入主内存的变量中。
